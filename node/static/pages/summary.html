<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Document</title>
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
		<link rel="stylesheet" href="../constants/styles.css" />
		<script src="../utils/helpers/mealRecommendation.js"></script>
		<script src="../components/header.js"></script>
		<script src="../components/footer.js"></script>
	</head>

	<body>

		<div id="header-container"></div>

		<div id="grid_parent">
		
			<div id="step_bar">
				<div id="step_links">

					<div class="linkContainers">
						<ul> 
							<li>
								<img class="step_icons" src="https://static-00.iconduck.com/assets.00/full-screen-icon-256x256-z03tmnai.png">
								<a class="stepLinks" id="order/choose-mealplan"><span class="link_spans"></span>Vælg måltidsplan</a>
								<i></i>
							</li>
						</ul>
					</div>
	
					<div class="linkContainers">
						<ul> 
							<li>
								<img class="step_icons" src="https://static-00.iconduck.com/assets.00/full-screen-icon-256x256-z03tmnai.png">
								<a class="stepLinks" id="order/set-profile"><span class="link_spans"></span>Sundhedsprofil</a>
								<i></i>
							</li>
						</ul>
					</div>
	
					<div class="linkContainers">
						<ul> 
							<li>
								<img class="step_icons" src="https://static-00.iconduck.com/assets.00/full-screen-icon-256x256-z03tmnai.png">
								<a class="stepLinks" id="order/nutritional-preference"><span class="link_spans"></span>Sundhedsmål</a>
								<i></i>
							</li>
						</ul>
					</div>

                    <div class="linkContainers" style="background-color: rgba(158, 158, 158, 0.384);">
						<ul> 
							<li>
								<img class="step_icons" style="filter: invert(0%) sepia(95%) saturate(21%) hue-rotate(2deg) brightness(92%) contrast(108%);" src="https://static-00.iconduck.com/assets.00/full-screen-icon-256x256-z03tmnai.png">
								<a class="stepLinks" id="order/summary" style="color: black;"><span class="link_spans"></span>Opsummering</a>
								<i></i>
							</li>
						</ul>
					</div>

				</div>  

				<div id="order_box">
					<span>Prisoversigt:</span>
					<span>wrgrewhesthtes</span>
				</div>
			</div>

			<div id="step_header">
				<span id="step_title">Opsummering</span>
				<button id="orderTitle">Måltidsplanlægning</button>
			</div>

			<div id="step_content">
				<div id="users">

				</div>

				<form class="profile_form" id="form1">

					<div id="summaryFormTitleContent">
						<span id="summaryFormTitle">Does this look correct?</span>
						<span id="summaryFormDescription">Lorem ipsum dolor sit amet consectetur adipisicing elit. Tempore sequi qui a nemo?</span>
					</div>

					<div class="summaryHorizontalLines"></div>

					<div id="userHealthDetailsParentContainer">

						<div id="userHealthDetails"> 
							<span>Your Sex</span>
							<div id="userRightHealthDetailsContainer">
								<span class="detailsContent">abc</span>
							</div>
						</div>
				
						<div id="userHealthDetails"> 
							<span>Your Age</span>
							<div id="userRightHealthDetailsContainer">
								<span class="detailsContent">abc</span>
							</div>
						</div>

						<div id="userHealthDetails"> 
							<span>Your Height</span>
							<div id="userRightHealthDetailsContainer">
								<span class="detailsContent">abc</span>
							</div>
						</div>
					
						<div id="userHealthDetails"> 
							<span>Your Weight</span>
							<div id="userRightHealthDetailsContainer">
								<span class="detailsContent">abc</span>
							</div>
						</div>

						<div id="userHealthDetails"> 
							<span>Your Occupation</span>
							<div id="userRightHealthDetailsContainer">
								<span class="detailsContent">abc</span>
							</div>
						</div>
					
				
				</div>

				<div class="summaryHorizontalLines"></div>

				<div id="userHealthDetailsParentContainer">

					<div id="userHealthDetails"> 
						<span>Your Goal</span>
						<div id="userRightHealthDetailsContainer">
							<span class="detailsContent">abc</span>
						</div>
					</div>
			
					<div id="userHealthDetails"> 
						<span>Your Preference</span>
						<div id="userRightHealthDetailsContainer">
							<span class="detailsContent">abc</span>
						</div>
					</div>

					<div id="userHealthDetails"> 
						<span>Your Approach</span>
						<div id="userRightHealthDetailsContainer">
							<span class="detailsContent">abc</span>
						</div>
					</div>
				
			</div>

			<div class="summaryHorizontalLines"></div>

	
					<div id="summarySubmitButtonContainer">
						<button type="submit" id="submitDetails">This is correct</button>
					</div>
				</form>
				<div id="userRequirements">

					<div id="energyRequirements">
							<span id="energyRequirementsTitle">Energifordeling</span>
							<div class="requirementsLines"></div>
					</div>
					
					
				<div class="requirementsParentContainers">

					<div class="BMRTDEEContainers"> 	

						<div> 
							<span>BMR ?</span>
						</div>
						<span style="font-size: 12px;">Basic Metabolic Rate</span>

						<div class="BMRTDEEBoxes">
							<span>1000</span>
						</div>
					</div>

					<div class="BMRTDEEContainers"> 
						<div> 
							<span>BMR ?</span>	   
						</div>
						<span style="font-size: 12px;">Basic Metabolic Rate</span>

						<div class="BMRTDEEBoxes">
							<span>1000</span>
						</div>
					</div>

				</div>


				<div id="macroRequirements">
					<span id="macroTitle">Anbefalet macros</span>
					<div class="requirementsLines"></div>
				</div>

				<div class="macrosParentContainer">

					<div class="macroRequirementBoxContainers"> 	

						<div> 
							<span>Proteiner ?</span>
						</div>
						<span style="font-size: 12px;">Daglig protein</span>

						<div class="macroBoxes" id="BMRBox">
							<span>1000</span>
						</div>
					</div>

					<div class="macroRequirementBoxContainers"> 
						<div> 
							<span>kulhydrater ?</span>	   
						</div>
						<span style="font-size: 12px;">Daglig kulhydrater</span>

						<div class="macroBoxes">
							<span>1000</span>
						</div>
					</div>

					<div class="macroRequirementBoxContainers"> 
						<div> 
							<span>Fedt ?</span>	   
						</div>
						<span style="font-size: 12px;">Daglig fedt</span>

						<div class="macroBoxes">
							<span>1000</span>
						</div>
					</div>

				</div>


			</div>

				<div id="userGreeting">
					<span> Hej bruger</span>
					<span>Lorem ipsum dolor sit amet consectetur adipisicing elit. Eaque omnis at error sint similique delectus totam tenetur vel optio. Commodi minima aliquid enim quasi, illo veniam dolor placeat debitis laboriosam?</span>
				</div>

			</div>
			</div>
			
	</div>

	
	<div id="footer-container"></div>
	
	<script src="../components/allPages.js"></script>

    <script>

        const submitInfo = document.getElementById("submitDetails")
        /* sends out the finalized information to the server */
        submitInfo.addEventListener("click", (e) => {
            e.preventDefault();
            let mealPlan = JSON.parse(localStorage.getItem('order/choose-mealplan'));
            let userDetails = JSON.parse(localStorage.getItem('order/set-profile'));
            let userPreferences = JSON.parse(localStorage.getItem('order/nutritional-preference'));


            allUserInfo = {mealPlan, userDetails, userPreferences};

            fetch("/ordering-data", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(allUserInfo),
            }).catch((error) => {
                console.error("Error", error);
            });;

        });


        /* dynamically renders a form for each profile */
			function profileRendering(numberOfPeople) {
				allProfiles = document.getElementById("users");

				addUserDetails(1);
				
				for (let i = 0; i < numberOfPeople; i++) {
					profile = document.createElement("div");
					profileNumber = document.createElement("span");
					profileNumber.innerHTML = i + 1;
					profile.id = `profile${i + 1}`;
					allProfiles.append(profile);
					profile.append(profileNumber);

					if (i >= 1) {
						let form = document.getElementById("form1");
						newForm = form.cloneNode(true);
						newForm.class = `profile_form`;
						newForm.id = `form${i + 1}`;
						newForm.style.visibility = "hidden";
						content = document.getElementById("step_content");
						content.appendChild(newForm);
						addUserDetails(i + 1);
					}
				}
			}
			
	
			/* adds user details to each box on the summary page */
			function addUserDetails(formNumber) {

				const preferencesDetails = JSON.parse(localStorage.getItem('order/nutritional-preference'));
				const profileDetails = JSON.parse(localStorage.getItem('order/set-profile'));

				let userProfile = profileDetails[formNumber - 1];
				let userPreferences = preferencesDetails[formNumber - 1];
				
				let form = document.querySelector(`#form${formNumber}`);
				let healthDetailsParentContainer = form.querySelectorAll("#userHealthDetailsParentContainer")
	
				/* for cases where the profile is a woman then add two more boxes */
				if (userProfile["sex"] === "female" && form.getElementsByClassName("pregOrLact").length < 1) {
					let pregnantOrLactating = document.createElement('div');
					pregnantOrLactating.innerHTML = detailsForWomen();
					healthDetailsParentContainer[1].appendChild(pregnantOrLactating.childNodes[0]);
					healthDetailsParentContainer[1].appendChild(pregnantOrLactating.childNodes[1]);
				} 
				/* for cases where the profile is a man then remove the added boxes from when the profiles are rendered */
				else if (userProfile["sex"] === "male")  {
					let elements = form.getElementsByClassName("pregOrLact");
					console.log(elements.length);
					delete userPreferences.pregnant;
					delete userPreferences.lactating;

					while (elements.length > 0) {
						healthDetailsParentContainer[1].removeChild(elements[0]);
					}
				}

				/* fills out the user information in the boxes */
				let rightDetails = form.getElementsByClassName("detailsContent");

				let i = 0;
				for (let key in userProfile) {
					rightDetails[i].textContent = userProfile[key].charAt(0).toUpperCase() + userProfile[key].slice(1);;;
					i++;
				}

				for (let key in userPreferences) {
					rightDetails[i].textContent = userPreferences[key].charAt(0).toUpperCase() + userPreferences[key].slice(1);;
					i++;
				}
			}

			const detailsForWomen = () => {
							return `<div class="pregOrLact" id="userHealthDetails"> 
										<span>Pregnant</span>
										<div id="userRightHealthDetailsContainer">
											<span class="detailsContent">False</span>
										</div>
									</div>

									<div class="pregOrLact" id="userHealthDetails"> 
										<span>Lactating</span>
										<div id="userRightHealthDetailsContainer">
											<span class="detailsContent">False</span>
										</div>
									</div>
									
									` }


			/* gets item from localStorage and renders a number of forms depending on the users input given on the first page */
			mealPlan = localStorage.getItem("order/choose-mealplan");
			data = JSON.parse(mealPlan);

			profileRendering(data.peopleAmount);

			for (let i = 1; i <= data.peopleAmount; i++) {
				swapForms(`profile${i}`, `form${i}`);
			}

			/* makes it possible to swap between forms by clicking on the profile boxes */
			function swapForms(profile, form) {
				document.getElementById(profile).addEventListener("click", function () {
					for (let i = 1; i <= data.peopleAmount; i++) {
						let formVisibility = document.getElementById(`form${i}`);
						let userColor = document.getElementById(`profile${i}`)
						userColor.style.height = "100%";
						userColor.style.backgroundColor = "#a0abc0"
						formVisibility.style.visibility = "hidden";
					}

					userColor = document.getElementById(profile);
					userColor.style.backgroundColor = "#2d3648"
					userColor.style.height = "104%";

					formVisibility = document.getElementById(form);
					formVisibility.style.visibility = "visible";
				});
			}

			/* loads header and footer */
    		 document.addEventListener("DOMContentLoaded", function () {
				const headerContainer = document.getElementById("header-container");
				headerContainer.innerHTML = Header();
			});

			document.addEventListener("DOMContentLoaded", function () {
				const headerContainer = document.getElementById("footer-container");
				headerContainer.innerHTML = Footer();
			});
	
    </script>