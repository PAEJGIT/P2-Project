<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Document</title>
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
		<link rel="stylesheet" href="../constants/styles.css" />
		<script src="../utils/helpers/mealRecommendation.js"></script>
		<script src="../components/header.js"></script>
		<script src="../components/footer.js"></script>
	</head>

	<body>

		<div id="header-container"></div>

		<div id="grid_parent">
		
			<div id="step_bar">
				<div id="step_links">

					<div class="linkContainers">
						<ul> 
							<li>
								<img class="step_icons" src="https://static-00.iconduck.com/assets.00/full-screen-icon-256x256-z03tmnai.png">
								<a class="stepLinks" id="order/choose-mealplan"><span class="link_spans"></span>Vælg måltidsplan</a>
								<i></i>
							</li>
						</ul>
					</div>
	
					<div class="linkContainers">
						<ul> 
							<li>
								<img class="step_icons" src="https://static-00.iconduck.com/assets.00/full-screen-icon-256x256-z03tmnai.png">
								<a class="stepLinks" id="order/set-profile"><span class="link_spans"></span>Sundhedsprofil</a>
								<i></i>
							</li>
						</ul>
					</div>
	
					<div class="linkContainers">
						<ul> 
							<li>
								<img class="step_icons" src="https://static-00.iconduck.com/assets.00/full-screen-icon-256x256-z03tmnai.png">
								<a class="stepLinks" id="order/nutritional-preference"><span class="link_spans"></span>Sundhedsmål</a>
								<i></i>
							</li>
						</ul>
					</div>

                    <div class="linkContainers" style="background-color: rgba(158, 158, 158, 0.384);">
						<ul> 
							<li>
								<img class="step_icons" style="filter: invert(0%) sepia(95%) saturate(21%) hue-rotate(2deg) brightness(92%) contrast(108%);" src="https://static-00.iconduck.com/assets.00/full-screen-icon-256x256-z03tmnai.png">
								<a class="stepLinks" id="order/summary" style="color: black;"><span class="link_spans"></span>Opsummering</a>
								<i></i>
							</li>
						</ul>
					</div>

				</div>  

				<div id="order_box">
					<span>Prisoversigt:</span>
					<span>wrgrewhesthtes</span>
				</div>
			</div>

			<div id="step_header">
				<span id="step_title">Opsummering</span>
				<button id="orderTitle">Måltidsplanlægning</button>
			</div>

			<div id="step_content">
				<div id="users">

				</div>

				<form class="profile_form" id="form1">
									
					<div id="stepbuttons">
						<button type="submit" id="submitDetails">Bekræft oplysninger</button>
					</div>
				</form>
			</div>
	</div>
	<div id="footer-container"></div>
	
	<script src="../components/allPages.js"></script>

    <script>

        const submitInfo = document.getElementById("submitDetails")
        
        submitInfo.addEventListener("click", (e) => {
            e.preventDefault();
            let mealPlan = JSON.parse(localStorage.getItem('order/choose-mealplan'));
            let userDetails = JSON.parse(localStorage.getItem('order/set-profile'));
            let userPreferences = JSON.parse(localStorage.getItem('order/nutritional-preference'));


            allUserInfo = {mealPlan, userDetails, userPreferences};

            fetch("/ordering-data", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(allUserInfo),
            }).catch((error) => {
                console.error("Error", error);
            });;

        });

        /* dynamically renders a form for each profile */
			function profileRendering(numberOfPeople) {
				allProfiles = document.getElementById("users");

				
				for (let i = 0; i < numberOfPeople; i++) {
					profile = document.createElement("div");
					profileNumber = document.createElement("span");
					profileNumber.innerHTML = i + 1;
					profile.id = `profile${i + 1}`;

					allProfiles.append(profile);
					profile.append(profileNumber);

					if (i >= 1) {
						let form = document.getElementById("form1");
						newForm = form.cloneNode(true);
						newForm.class = `profile_form`;
						newForm.id = `form${i + 1}`;
						newForm.style.visibility = "hidden";
						content = document.getElementById("step_content");
						content.appendChild(newForm);
						addChildIds(i + 1);
					}
				}
			}
	

			function addChildIds(formNumber) {

				let childInputs = document.querySelectorAll(`#form${formNumber} input`);
				let childSelects = document.querySelectorAll(`#form${formNumber} select`);

				let firstFormInputs = document.querySelectorAll(`#form1 input`);
				let firstFormSelects = document.querySelectorAll(`#form1 select`);

					for (let i = 0; i < childInputs.length; i++) {
						childInputs[i].id = firstFormInputs[i].id + `${formNumber}`;
					}

					for (let i = 0; i < childSelects.length; i++) {
						childSelects[i].id = firstFormSelects[i].id + `${formNumber}`;
					}
			}


			mealPlan = localStorage.getItem("order/choose-mealplan");
			data = JSON.parse(mealPlan);

			profileRendering(data.peopleAmount);

			for (let i = 1; i <= data.peopleAmount; i++) {
				swapForms(`profile${i}`, `form${i}`);
			}

			/* makes it possible to swap between forms by clicking on the profile boxes */
			function swapForms(profile, form) {
				document.getElementById(profile).addEventListener("click", function () {
					for (let i = 1; i <= data.peopleAmount; i++) {
						let formVisibility = document.getElementById(`form${i}`);
						let userColor = document.getElementById(`profile${i}`)
						userColor.style.height = "100%";
						userColor.style.backgroundColor = "#a0abc0"
						formVisibility.style.visibility = "hidden";
					}

					userColor = document.getElementById(profile);
					userColor.style.backgroundColor = "#2d3648"
					userColor.style.height = "104%";

					formVisibility = document.getElementById(form);
					formVisibility.style.visibility = "visible";
				});
			}










     document.addEventListener("DOMContentLoaded", function () {
				const headerContainer = document.getElementById("header-container");
				headerContainer.innerHTML = Header();
			});
			document.addEventListener("DOMContentLoaded", function () {
				const headerContainer = document.getElementById("footer-container");
				headerContainer.innerHTML = Footer();
			});
	
    </script>