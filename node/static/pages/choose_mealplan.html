<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="../constants/styles.css">
    <script src="../components/header.js"></script>
    <script src="../components/footer.js"></script>
</head>

<body>

    <div id="header-container"></div>
    
    <div id="grid_parent">
    
  

        
        
        <div id="step_bar">

            <div id="step_links">

            
                <div class="linkContainers" style="background-color: rgba(158, 158, 158, 0.384);">
                    <ul> 
                        <li>
                            <img class="step_icons" style="filter: invert(0%) sepia(95%) saturate(21%) hue-rotate(2deg) brightness(92%) contrast(108%);" src="https://static-00.iconduck.com/assets.00/full-screen-icon-256x256-z03tmnai.png">
                            <a class="stepLinks" id="order/choose-mealplan" style="color: black;"><span class="link_spans"></span>Vælg måltidsplan</a>
                            <i></i>
                        </li>
                    </ul>
                </div>

                <div class="linkContainers">
                    <ul> 
                        <li>
                            <img class="step_icons" src="https://static-00.iconduck.com/assets.00/full-screen-icon-256x256-z03tmnai.png">
                            <a class="stepLinks" id="order/set-profile"><span class="link_spans"></span>Sundhedsprofil</a>
                            <i></i>
                        </li>
                    </ul>
                </div>

				<div class="linkContainers">
                    <ul> 
                        <li>
                            <img class="step_icons" src="https://static-00.iconduck.com/assets.00/full-screen-icon-256x256-z03tmnai.png">
                            <a class="stepLinks" id="order/nutritional-preference"><span class="link_spans"></span>Sundhedsmål</a>
                            <i></i>
                        </li>
                    </ul>
                </div>

                <div class="linkContainers">
                    <ul> 
                        <li>
                            <img class="step_icons" src="https://static-00.iconduck.com/assets.00/full-screen-icon-256x256-z03tmnai.png">
                            <a class="stepLinks" id="order/summary"><span class="link_spans"></span>Opsummering</a>
                            <i></i>
                        </li>
                    </ul>
                </div>

            </div>  

            <div id="order_box">
                <span>Prisoversigt:</span>
                <span>wrgrewhesthtes</span>
            </div>
            
        </div>
        

        <div id="step_header">
            <span id="step_title">Vælg Måltidsplan</span>
            <button id="orderTitle">Måltidsplanlægning</button>
        </div>

        <div id="step_content">

            <div id="select_plan">
                
                <span>Vælg antal personer og måltider</span>

                <form action="set-profile" method="GET"> 

                    <div id="number_of_people"> 
        
                        <div> 
                            <span>Antal personer</span>
                            <input class="peopleRadios" type="radio" name="number_of_people" id="one_person" value="1" checked/>
                            <input class="peopleRadios" type="radio" name="number_of_people" id="two_people" value="2"/>
                            <input class="peopleRadios" type="radio" name="number_of_people" id="three_people" value="3"/>
                            <input class="peopleRadios" type="radio" name="number_of_people" id="four_people" value="4"/>
                        
                            <label for="one_person">1</label>
                            <label for="two_people">2</label>
                            <label for="three_people">3</label>
                            <label for="four_people">4</label>
                        </div>
                        
                    </div>

                     <div id="number_of_meals"> 

                        <span>Antal måltidspakker</span>
                        <input class="mealRadios" type="radio" name="number_of_meals" id="one_meal" value="1" checked/>
                        <input class="mealRadios" type="radio" name="number_of_meals" id="two_meals" value="2"/>
                        <input class="mealRadios" type="radio" name="number_of_meals" id="three_meals" value="3"/>
                        <input class="mealRadios" type="radio" name="number_of_meals" id="four_meals" value="4"/>
                        <input class="mealRadios" type="radio" name="number_of_meals" id="five_meals" value="5"/>
    
                        <label for="one_meal">1</label>
                        <label for="two_meals">2</label>
                        <label for="three_meals">3</label>
                        <label for="four_meals">4</label>
                        <label for="five_meals">5</label>
                       
                      </div>
                
                    <input id="select_plan_submit" type="submit" onclick="saveChoice()">

                </form>

            </div>

        </div>
    </div>
            
    

          <div id="footer-container"></div>


    <script src="../components/allPages.js"></script>
    
    <script>
        let inputButton = document.getElementById("select_plan_submit");
        inputButton.addEventListener("submit", updateCompletedSteps());

        // if data already exists then set the default value to what the user had previously picked
        if (localStorage.getItem('order/choose-mealplan')) {
            const formData = JSON.parse(localStorage.getItem('order/choose-mealplan'));

            let peopleRadios = document.getElementsByClassName('peopleRadios');
            let mealRadios = document.getElementsByClassName('mealRadios');

            for (let i = 0; i < peopleRadios.length; i++) {
            if (peopleRadios[i].value === formData.peopleAmount) {
                peopleRadios[i].checked = true;
                break;       
             }
            }

            for (let i = 0; i < mealRadios.length; i++) {
            if (mealRadios[i].value === formData.mealAmount) {
                mealRadios[i].checked = true;
                break;       
             }
            }
        }


    // Save form data to localStorage when user navigates away from the page
        function saveChoice() {
            window.addEventListener('beforeunload', () => {
            let peopleRadios = document.getElementsByClassName('peopleRadios');
            let mealRadios = document.getElementsByClassName('mealRadios');

            let mealValue;
            let peopleValue;
            
            for (let i = 0; i < peopleRadios.length; i++) {
            if (peopleRadios[i].type === 'radio' && peopleRadios[i].checked) {
                peopleValue = peopleRadios[i].value;
                break;       
             }
            }

             for (let i = 0; i < mealRadios.length; i++) {
             if (mealRadios[i].type === 'radio' && mealRadios[i].checked) {
                mealValue = mealRadios[i].value;
                break;       
             }
            }

            const formData = {
                peopleAmount: peopleValue,
                mealAmount: mealValue 
            };

            localStorage.setItem('order/choose-mealplan', JSON.stringify(formData));


        });
    }


    let step2Page = "http://localhost:3262/order/set-profile";
    
    let jsonData = localStorage.getItem("order/choose-mealplan");
    let step1Data = JSON.parse(jsonData);
    

    function nextPage(stepData, nextPage) {
        if (!stepData) {
            window.alert("Please enter all your details!");
            return false;   
         }
         
        for (let key in stepData) {
            if (stepData[key] === null || stepData[key] === undefined || stepData[key] === '') {
                window.alert("Please enter all your details!");
                return false;
            }
        }
        window.location.href = nextPage;
}


    document.addEventListener("DOMContentLoaded", function () {
				const headerContainer = document.getElementById("header-container");
				headerContainer.innerHTML = Header();
			});
			document.addEventListener("DOMContentLoaded", function () {
				const headerContainer = document.getElementById("footer-container");
				headerContainer.innerHTML = Footer();
			});


    </script>

</body>
</html>