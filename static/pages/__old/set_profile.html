<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Document</title>
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
		<link rel="stylesheet" href="../constants/styles.css" />
		<script src="../utils/helpers/mealRecommendation.js"></script>
		<script src="../components/header/header.js"></script>
		<script src="../components/footer/footer.js"></script>
	</head>

	<body>
		<div id="header-container"></div>

		<div id="grid_parent">
			<div id="step_bar">
				<div id="step_links">
					<div class="linkContainers">
						<ul>
							<li>
								<img
									class="step_icons"
									src="https://static-00.iconduck.com/assets.00/full-screen-icon-256x256-z03tmnai.png" />
								<a class="stepLinks" id="order/choose-mealplan"
									><span class="link_spans"></span>Vælg måltidsplan</a
								>
								<i></i>
							</li>
						</ul>
					</div>

					<div class="linkContainers" style="background-color: rgba(158, 158, 158, 0.384)">
						<ul>
							<li>
								<img
									class="step_icons"
									style="
										filter: invert(0%) sepia(95%) saturate(21%) hue-rotate(2deg) brightness(92%)
											contrast(108%);
									"
									src="https://static-00.iconduck.com/assets.00/full-screen-icon-256x256-z03tmnai.png" />
								<a class="stepLinks" id="order/set-profile" style="color: black"
									><span class="link_spans"></span>Sundhedsprofil</a
								>
								<i></i>
							</li>
						</ul>
					</div>

					<div class="linkContainers">
						<ul>
							<li>
								<img
									class="step_icons"
									src="https://static-00.iconduck.com/assets.00/full-screen-icon-256x256-z03tmnai.png" />
								<a class="stepLinks" id="order/nutritional-preference"
									><span class="link_spans"></span>Sundhedsmål</a
								>
								<i></i>
							</li>
						</ul>
					</div>

					<div class="linkContainers">
						<ul>
							<li>
								<img
									class="step_icons"
									src="https://static-00.iconduck.com/assets.00/full-screen-icon-256x256-z03tmnai.png" />
								<a class="stepLinks" id="order/summary"><span class="link_spans"></span>Opsummering</a>
								<i></i>
							</li>
						</ul>
					</div>
				</div>

				<div id="order_box">
					<span>Prisoversigt:</span>
					<span>wrgrewhesthtes</span>
				</div>
			</div>

			<div id="step_header">
				<span id="step_title">Sundhedsprofil</span>
				<button id="orderTitle">Måltidsplanlægning</button>
			</div>

			<div id="step_content">
				<div id="users"></div>

				<form action="nutritional-preference" method="GET" class="profile_form" id="form1">
					<div>
						<div class="input_container inputText">
							<label for="select_sex" id="label_sex" class="input_label">Your Sex</label>
							<span class="input_description"
								>Your biological sex is defined by your number of chromosomes.</span
							>
							<select name="sex" id="select_sex" class="input_field" required>
								<option value="" selected>— Vælg et køn —</option>
								<option value="male">Mand</option>
								<option value="female">Kvinde</option>
							</select>
						</div>
					</div>

					<div>
						<div class="input_container inputText">
							<label for="age" class="input_label">Your Age</label>
							<span class="input_description"
								>Your age is defined by date of birth minus today's date.</span
							>
							<input
								class="input_field"
								type="number"
								id="age"
								min="10"
								max="100"
								name="age"
								step="1"
								required />
						</div>
					</div>

					<div>
						<div class="input_container inputText">
							<label for="weight" class="input_label">Your Weight</label>
							<span class="input_description">Your weight is defined by your body weight in kg.</span>
							<input
								class="input_field"
								type="number"
								id="weight"
								min="30"
								max="400"
								name="weight"
								step="1"
								required />
						</div>
					</div>

					<div>
						<div class="input_container inputText">
							<label for="weight" class="input_label">Your Height</label>
							<span class="input_description">Your height is defined by your body length in cm.</span>
							<input
								class="input_field"
								type="number"
								id="height"
								min="120"
								max="220"
								name="height"
								step="1"
								required />
						</div>
					</div>

					<div>
						<div class="input_container inputText">
							<label for="select_activity" id="label_activity" class="input_label"
								>What are your current occupation?</label
							>
							<span class="input_description"
								>Your occupation is defined by an average of your activity.</span
							>
							<select name="activitylevel" id="select_activity" class="input_field" required>
								<option value="" selected>— Vælg et aktivitetsniveau —</option>
								<option value="1">Lidt eller ingen aktivitet</option>
								<option value="2">Lidt aktiv (let motion 1-2 gange/uge)</option>
								<option value="3">Ret aktiv (moderat motion 2 dage/uge)</option>
								<option value="4">Aktiv (let/moderat motion 3-4 dage/uge)</option>
								<option value="5">Meget aktiv (Hård motion 4-6 dage/uge)</option>
							</select>
						</div>
					</div>

					<div id="stepbuttons">
						<button id="nextButton">Next</button>
					</div>
				</form>

				<div id="userRequirements">
					<div id="energyRequirements">
						<span class="nutritional-box-section-title">Energy Requirements</span>
						<div class="nutritional-box-section-divider"></div>
					</div>

					<div class="requirementsParentContainers">
						<div class="BMRTDEEContainers">
							<div class="nutritional-box-title-container">
								<span class="nutritional-box-title">BMR</span>
								<img
									class="nutritional-box-title-image"
									src="../assets/icons/icon_info.svg"
									alt="info" />
							</div>
							<span class="nutritional-box-description">Basic Metabolic Rate</span>

							<div class="nutritional-box-content-container">
								<span id="BMR_text" class="nutritional-box-content-text"></span>
							</div>
						</div>

						<div class="BMRTDEEContainers">
							<div class="nutritional-box-title-container">
								<span class="nutritional-box-title">TDEE</span>
								<img
									class="nutritional-box-title-image"
									src="../assets/icons/icon_info.svg"
									alt="info" />
							</div>
							<span class="nutritional-box-description">Total Daily Energy Expenditure</span>
							<div class="nutritional-box-content-container">
								<span id="TDEE_text" class="nutritional-box-content-text"></span>
							</div>
						</div>
					</div>

					<div id="macroRequirements">
						<span id="macroTitle">Macronutrient Requirements</span>
						<div class="nutritional-box-section-divider"></div>
					</div>

					<div class="macrosParentContainer">
						<div class="macroRequirementBoxContainers">
							<div class="nutritional-box-title-container">
								<span class="nutritional-box-title">Proteins</span>
								<img
									class="nutritional-box-title-image"
									src="../assets/icons/icon_info.svg"
									alt="info" />
							</div>
							<span class="nutritional-box-description">Daily Proteins</span>

							<div class="nutritional-box-content-container" id="BMRBox">
								<span class="nutritional-box-content-text">1000</span>
							</div>
						</div>

						<div class="macroRequirementBoxContainers">
							<div class="nutritional-box-title-container">
								<span class="nutritional-box-title">Carbohydrates</span>
								<img
									class="nutritional-box-title-image"
									src="../assets/icons/icon_info.svg"
									alt="info" />
							</div>
							<span class="nutritional-box-description">Daily Carbohydrates</span>

							<div class="nutritional-box-content-container">
								<span class="nutritional-box-content-text">1000</span>
							</div>
						</div>

						<div class="macroRequirementBoxContainers">
							<div class="nutritional-box-title-container">
								<span class="nutritional-box-title">Fats</span>
								<img
									class="nutritional-box-title-image"
									src="../assets/icons/icon_info.svg"
									alt="info" />
							</div>
							<span class="nutritional-box-description">Daily Fats</span>

							<div class="nutritional-box-content-container">
								<span class="nutritional-box-content-text">1000</span>
							</div>
						</div>
					</div>
				</div>

				<div id="userGreeting">
					<span id="user-welcome-title" class="nutritional-intro-user-title">Hello {user},</span>
					<span class="nutritional-intro-user-description"
						>This is your current template, which will be used to find appropriate recipes for your macro
						nutritional needs. If you’ve any questions regarding the calculations, do not hesitate to
						<span class="nutritional-intro-contact-us-link">contact us</span>.</span
					>
				</div>
			</div>
		</div>

		<div id="footer-container"></div>

		<script src="../components/allPages.js"></script>
		<script src="../utils/main_page_scripts/set_profile_script.js"></script>
		<script>
			document.getElementById('select_sex').addEventListener('change', getFormData);
			document.getElementById('age').addEventListener('change', getFormData);
			document.getElementById('weight').addEventListener('change', getFormData);
			document.getElementById('height').addEventListener('change', getFormData);
			document.getElementById('select_activity').addEventListener('change', getFormData);

			function getFormData() {
				let BMR = 0;
				let TDEE = 0;
				const sex = document.getElementById('select_sex').value;
				const age = document.getElementById('age').value;
				const weight = document.getElementById('weight').value;
				const height = document.getElementById('height').value;
				const activity = document.getElementById('select_activity').value;

				const BMR_text = document.getElementById('BMR_text');
				const TDEE_text = document.getElementById('TDEE_text');

				if (sex && age && weight && height) {
					BMR_text.textContent = Math.round(calculateBMR(sex, age, weight, height));
					if (activity == '') {
						TDEE_text.textContent = 'Loading';
					}
					if (activity) {
						TDEE = calculateTDEE(BMR_text.textContent, activity);
						TDEE_text.textContent = Math.round(TDEE);
					}
				} else {
					BMR_text.textContent = 'Loading';
					TDEE_text.textContent = 'Loading';
				}
			}

			const calculateBMR = (sex, age, weight, height) => {
				if (!['male', 'female'].includes(sex) || age <= 0 || weight <= 0 || height <= 0) {
					throw new Error('Invalid input values for calculating BMR.');
				} else {
					const BMR =
						sex === 'male'
							? 88.362 + 13.397 * weight + 4.799 * height - 5.677 * age
							: 447.593 + 9.247 * weight + 3.098 * height - 4.33 * age;
					return BMR;
				}
			};

			const calculateTDEE = (BMR, activityFactor) => {
				let TDEE = 0;
				BMR = Math.round(BMR);

				console.log(BMR, activityFactor);
				if (activityFactor < 1 || activityFactor > 5) {
					throw new Error('Invalid input values for calculating TDEE.', {
						cause: "Invalid input for 'activityFactor'",
					});
				} else {
					switch (activityFactor) {
						case '1':
							TDEE += BMR * 1.2;
							break;
						case '2':
							TDEE += BMR * 1.375;
							break;
						case '3':
							TDEE += BMR * 1.55;
							break;
						case '4':
							TDEE += BMR * 1.725;
							break;
						case '5':
							TDEE += BMR * 1.9;
							break;
						default:
							throw new Error('Unexpected activityFactor value.', {
								cause: `Unexpected value: ${activityFactor}`,
							});
					}
					return TDEE;
				}
			};
		</script>
	</body>
</html>
